language: js
name: avoid_ws_websocket
message: Use secure WebSocket (wss://) instead of insecure ws:// protocol
category: security

pattern: |
  (new_expression
    constructor : (identifier) @new_web_socket (#eq? @new_web_socket "WebSocketServer")
      arguments : (arguments
        (string
        	(string_fragment) @ws (#match? @ws "^ws:\/\/(?!(localhost|(\d{1,3}\.){3}\d{1,3}))")
        )
          
      ) 
      
  ) @avoid_ws_websocket
description: |
  Your code is using an insecure WebSocket connection (ws://). This poses several security risks:
  - Unencrypted data transmission
  - Vulnerability to man-in-the-middle attacks
  - Risk of data interception
  - Potential browser blocking on HTTPS sites

  ***Example of Insecure Code:***
  `const socket = new WebSocket("ws://example.com");`

  ***Security risks:***
  - Data is transmitted in plaintext
  - Attackers can intercept and modify messages
  - Modern browsers may block insecure WebSocket connections

  ***Fixed code:***
  ` const socket = new WebSocket("wss://example.com");`

  ***Benefits over the insecure code:***
  - TLS/SSL encryption for all communications
  - Protection against man-in-the-middle attacks
  - Compatible with HTTPS websites
  - Better browser security compliance