language: py
name: hashids-with-flask-secret
message: Do not use Flask secret key as salt in HashIDs
category: security

pattern: >
  (call
    function: (identifier) @hashid
    arguments: (argument_list
      (_)*
      (keyword_argument
        name: (identifier) @salt
        value: (subscript
          value: (attribute
            object: (identifier)
            attribute: (identifier) @config)
          subscript: (string
            (string_content) @secretkey)))
      (_)*)
    (#eq? @hashid "Hashids")
    (#eq? @salt "salt")
    (#eq? @config "config")
    (#eq? @secretkey "SECRET_KEY")) @hashids-with-flask-secret


description: >
  The Flask secret is vulnerable if its used as salt in HashID, because it is not
  cryptographically secure. By collecting and analyzing a sufficient number of HashIDs, attackers can recover the salt value, effectively exposing the Flask secret key and potentially compromising the application's security.